10 POKE &H40B2,&HB4 : POKE &H40B1,&HFF :'SET MEMSIZE TO B4FFH20 CLEAR 500: DEFINTA-Z40 DEFFNIS!(I)=-((I<0)*(65536+I)+((I>=0)*I))50 GOSUB 40170: GOSUB 4018055 REM         *** READ IN USER ROUTINES ***60 CMD"LOAD USERRTNS/LIB"91 GOSUB 50540    'INITILIZE DCB110 PRINT@1000,"PRESS <ENTER)";: GOSUB 310117 GOSUB 50830   'INITILIZE CONTROL VECTOR AND MEMORY POINTERS120 IM=600: U=&HB500130 LM=1000                'SPACE FOR 1000 FILES139 ONERRORGOTO141140 DA$=LEFT$(TIME$,8)141 CLS:IFVAL(DA$)=0THENLINEINPUT"GIVE DATE: ";DA$:DA$="DATE "+DA$:CMD DA$:GOTO140142 ONERRORGOTO0150  P=64151 C(1)=1: Z=C(4)        'READY TO STORE FILE152 C$="LIBDAT"153 GOTO3040160 FT$="DISK": GOTO 510  'FT$=FILE TYPE (INITALLY BY DISK)300 '                 ******* KEYSTROKES ********310 PRINTCHR$(14);330 A$=INKEY$:IFA$="" THEN 330 ELSEPRINT A$;: A=VAL(A$)334 IFASC(A$)>90THENA$=RIGHT$(CHR$(ASC(A$)-32),1)335 PRINTCHR$(15);336 RETURN500 '          ********** MENU **********510 GOSUB 40170520 IF FT$="" THEN SF$="":             SN$="" ELSE    IF FT$="DISK"  THEN SF$=", BY FILENAME": SN$=" DISK"                  ELSE SF$=", BY DISK    ": SN$=" FILENAME"530 PRINT@325,  "R - READ A DISK DIRECTORY":PRINT540 PRINTTAB(10)"!	 - RESTART THE PROGRAM":PRINT550 PRINTTAB(15)"S - SORT THE FILE";SF$: PRINT560 PRINTTAB(20)"P - PRINT THE FILE": PRINT570 PRINTTAB(25)"F - FILE MANIPULATION": PRINT580 PRINTTAB(30)"Q - SAVE THE FILE AND QUIT";590 PRINT@197,">>> ";C(4);" PROGRAMS IN THE FILE, SORTED BY";     SN$;" <<<";600 PRINT@768,"CHOICE ?  ";: GOSUB310610 IF A$="R" THEN 1010620 IF A$="!" THEN RUN630 IF A$="S" THEN GOSUB 4010: GOTO 510640 IF A$="P" THEN 5010650 IFA$="Q"THEN GOTO 3220660 IF A$="F" THEN 6010670 GOTO 5101000 '                 ***** READ DISK DIRECTORY *****1010 GOSUB 402401020 R=0:C(1)=1                    'READY TO ADD FILES1030 PRINT@520,"DO YOU WANT INVISIBLE FILES CATALOGED (Y/N) ? ";     :GOSUB3101040 IF A$="Y" THEN P=64: GOTO 10701050 IF A$="N" THEN P=23: GOTO 10701060 GOTO 5101070 PRINT@650,"WANT TO SEE THE SECTORS AS THEY ARE READ  ? ";        :GOSUB 310: IF LEFT$(A$,1)="Y" THEN R=-11080 PRINT@788,"DRIVE NUMBER  ?  ";: GOSUB 3101090 IF A$>="0" AND A$<="2" THEN 11101100 GOTO 5101110 DN=A: POKE DB+6,DN        'PUT DRIVE # IN DCB1120 POKE TR,0: POKE SR,0     'SET TO TRACK 0, SECTOR 01130 J=USR3(DB)               'READ BOOT1140 IF R THEN CLS: J1=USR5(0):      IF J<>0 THEN PRINT@990,"PRESS <ENTER>";: GOSUB 3101150 IF J<>0 THEN 2010          'JUMP IF DISK ERROR1160 DT=PEEK(BF+2)            'GET DIR TRACK1170 POKE TR,DT: POKE SR,0    'SET DCB TO GAT1180 J=USR3(DB)               'READ GAT1190 IF R THEN J1=USR5(0)1200 FG=0:DN$="":DD$=""1210 FORI=0TO7: DN$=DN$+CHR$(PEEK(BF+&HD0+I)):NEXT ' DISK NAME1220 FORI=8TO15:DD$=DD$+CHR$(PEEK(BF+&HD0+I)):NEXT ' DISK DATE1230 FOR I=0 TO &H5F: BY=PEEK(BF+I)1240   IF BY=255 THEN 12901250   IF BY=248 THEN FG=FG+3: GOTO12901260   IF BY=252 THEN FG=FG+2: GOTO12901270   FG=FG+11280   IF BY<251 THEN FG=FG+11290 NEXT I1300 FG$=STR$(FG): FG$=RIGHT$("   "+FG$,3)1301 FORSS=6TO8:S1=ASC(MID$(DN$,SS,1))1302 IFS1>&H39ORS1<&H30THEN13041303 NEXTSS:GOTO13101304 PRINT:PRINTDN$;" IS AN UNCOMPATABLE DISK NAME. IT MUST BE ONLY5 LETTERS LONG. ";1305 CMD"lc,n":LINEINPUT"ENTER A NEW DISK NAME: ";Z2$:IFLEN(Z2$)>5THEN1303:ELSEZ2$=LEFT$(Z2$+"*****",5)1306 INPUT"WHAT IS THE DISK NUMBER";Z11307 Z1$=STR$(Z1):Z1$=RIGHT$(Z1$,LEN(Z1$)-1):DN$=Z2$+RIGHT$("000"+Z1$,3)1308 Z2$="PROT"+STR$(DN)+" NAME="+DN$:CMD Z2$1309 CMD"lc,y":CLS1310 IF NOT R THEN GOSUB 400101311 DM$=RIGHT$(DN$,3):C(1)=0:C(0)=1:C(7)=0:C(8)=VARPTR(DM$):C(4)=C(4)+11312 J=USR2(VARPTR(C(0)))1313 C(4)=C(4)-11314 IFJ<>0THENPRINT"THIS DISK NUMBER IS REGISTERED!! FUNCTION TERMINATED!!!":FORX=1TO5000:A$=INKEY$:IFA$=""THENNEXTX:ELSE5101316 C(1)=11320 LSET NF$=RIGHT$(DN$,3)+" "+LEFT$(DN$,5)+"      "+FG$1330 J=USR0(VARPTR(C(0)))        'PUT DISK DATA TO ARRAY1340 POKE SR,3                   'SET TO SECTOR 31350 J=USR3(DB)                  'READ 3RD DIRECTORY SECTOR1360 IF R THEN J1=USR5(0)1370 DG=PEEK(BF+23)+1            '# OF DIRECTORY GRANS1380 DS=5*DG1390 IF DT$="LDOS" DS=6*DG       '# OF DIRECTORY SECTORS1400 POKE TG,DG-1                'SET DIR GRANS1410 FOR IS=2 TO DS-1: POKE DB+10,IS1420   J=USR3(DB)                'READ SECTOR #IS1430   IF R THEN J1=USR5(0)1440   FOR DC=0 TO 7: FB=BF+32*DC         'DEC LOOP1450     PR=PEEK(FB)                      'PROTECTION1460     IF PR>P OR PR<16 THEN 16201470     F$=""1480     FOR I=5 TO 12: A=PEEK(FB+I)1490       IF A<>32 THEN F$=F$+CHR$(A)1500     NEXT I1510     A=PEEK(FB+13)1520     IF A=32 THEN 15401530     F$=F$+"/"+CHR$(A)+CHR$(PEEK(FB+14))+CHR$(PEEK(FB+15))1540     GT=01550     FOR J=0 TO 6 STEP2: IF PEEK(FB+22+J)=255 THEN 15901560       GR=31 AND (PEEK(FB+23+J)+1)1570       GT=GT+GR: GT$=STR$(GT):GT$=RIGHT$("   "+GT$,3)1580     NEXT J1590     LSET NF$=RIGHT$(DN$,3)+LEFT$(F$+"          ",12)+GT$1600     IF NOT R THEN PRINT USING PF$;PR;F$;PEEK(FB+20);GT1610     J=USR0(VARPTR(C(0)))1620   NEXT DC1630 NEXT IS1640 IF NOT R THEN GOSUB 400501650 GOSUB 40060: IF A$="" THEN 16701660 IF A$>="0" AND A$<="2" THEN 11101670 GOSUB 4030: GOTO 5102000 REM         ************* DISK ERROR /LOOKUP *************2010 CLS: PRINT@448,"DISK ERROR (CODE";J;"), ";:     IF J=8 THEN PRINT" DEVICE NOT AVAILABLE." ELSE IF J=5 THEN     PRINT"DATA RECORD NOT FOUND DURING READ.": PRINT2020 IF J=8 THEN PRINT@990,"PRESS <ENTER>";:GOSUB 310:GOTO 21502030 PRINTTAB(5)"1. - CANCEL DISK READ.2040 PRINTTAB(5)"2. - I WANT TO TRY SOMETHING.2070 PRINT:PRINTTAB(10)"CHOICE:  ?  ";: GOSUB 3102080 ON A GOTO 2150, 21002090 GOTO 21502100 PRINT:PRINT:PRINT"   OK - I HAVE EXECUTED A <BREAK> YOU CAN NOW TRY SOMETHING.       IF NEWDOS/80 V2 LET ME SUGGEST SOMETHING LIKE      CMD";CHR$(34);"PDRIVE 0 2=5A";CHR$(34);"   AFTER WHICH (OR NOW!) SIMPLY <CONT>.2110 STOP: GOTO11302150 IF C(4)>0 THEN GOSUB 40302160 GOTO 5103000 '        ***************** DISK I/O ******************3030 '                *** READ A FILE FROM DISK ***3040 C(1)=1: Z=C(4)        'READY TO STORE FILE3050 GOSUB 40120             'GET FILESPEC3060 ONERROR GOTO 3200       'AVOID DISK I/O BOMBS3070 OPEN "I",1,C$3080 IF EOF(1) THEN 32003090 INPUT#1,D1$3100 PRINT: PRINT"FILE DATE IS:  ";D1$: PRINT:      IF LEN(D1$) =8 THEN 31203110 PRINT"INCOMPATABLE FILE !!!!!!!": FORI=1TO1000:NEXT: CLOSE:     GOTO 5103120 FOR X=Z+1 TO LM3130   IF EOF(1) THEN 31903140   INPUT#1,NF$3150   J=USR0(VARPTR(C(0)))       'PUT ON TOP OF ARRAY3160   PRINT CHR$(29);TAB(20)X;") ";NF$;3170 NEXT X3180 IF X>=LM THEN PRINT"ARRAY IS NOW FULL !!!!":     FORI=1TO1000:NEXT3190 CLOSE: GOSUB4030: GOTO 5103200 PRINT@460,"F I L E   N O T   F O U N D !!!!!!!!":      FORI=1TO1000: NEXT: CLOSE: RESUME 5103210 '                *** SAVE FILE TO DISK ***3220 C(1)=0: Z=C(4)           'READY TO READ ARRAY3230 GOSUB 40130                'GET FILESPEC3240 OPEN"O",1,C$3250 PRINT#1,DA$3260 PRINT: PRINT"FILE DATED:  ";DA$: PRINT3270 FOR X=1 TO Z: C(0)=X3280   J=USR0(VARPTR(C(0)))3290   PRINT#1,NF$3300   PRINT CHR$(29);TAB(20)X;") ";NF$;3310 NEXT X3320 CLOSE: END4000 '        ******************* SORT ********************4010 IF FT$="FILENAME" THEN 40304020 C(9)=&H3C00: C(7)=3: C(8)=12: FT$="FILENAME": GOTO 40404030 C(9)=&H3C00: C(7)=0: C(8)=15: FT$="DISK"4040 PRINT@17,"<<==== *** SORTING ***                         ";4050 J=USR1(VARPTR(C(0)))4060 PRINT@0,CHR$(30);4070 RETURN5000 '        **************** PRINT/LIST *****************5010 CLS: IFC(4)>0 THEN 50205015 PRINT@460,"N O   F I L E   ! ! ! ! !": FORI=1TO500:NEXT:      GOTO 5105020 CLS: PRINT@448,"BY (D)ISK OR (F)ILENAME ?  ";: GOSUB3105030 IF NOT(A$="D" OR A$="F") THEN 5105040 IF FT$="FILENAME" AND A$="D" THEN GOSUB 4010  'SORT IT5050 GOSUB 400805060 B$=A$: PRINT: PRINT"ENTER 'H' FOR HARDCOPY...";: GOSUB3105070 Z=C(4): C(1)=0: NF$=STRING$(18," "): C(5)=VARPTR(NF$)5080 PRINT: IF B$="D" THEN GOSUB 5110 ELSE GOSUB 52905090 PRINT@1000,"PRESS <ENTER>";: GOSUB 310: GOTO 5105100 '               *** PRINT BY DISKFILE ***5110 QQ=0: Q=0: B$=""5112 DG$=A$:PRINT"List Directory? ";:GOSUB310:IFA$="Y"THENDF=1ELSEDF=05113 A$=DG$5115 IF A$="H" THEN GOSUB 401005120 FOR X=1 TO Z5130   C(0)=X: J=USR0(VARPTR(C(0)))5140   IF B$<>LEFT$(NF$,3) THEN GOTO 52005141 IFDF=0THEN52505150   PRINT"   ";MID$(NF$,4,12);" ";RIGHT$(NF$,3);:IF A$="H"       THEN LPRINT"   ";MID$(NF$,4,12);" ";RIGHT$(NF$,3);5160   Q=Q+1: IFQ=3 THEN Q=0: PRINT5170   IF A$="H" THEN QQ=QQ+1: IF QQ=4 THEN QQ=0: LPRINT" ":L=L+15175   IF L=60 THEN GOSUB 401155180   Q$=INKEY$: IF Q$<>"" THEN GOSUB 55105190   GOTO 52505200   PRINT: PRINT: IF A$<>"H" THEN 52105205   IF L>=57 THEN FOR II=L TO 60-L: LPRINT" ": NEXT: GOSUB 40115       ELSE LPRINT" ": LPRINT" ": L=L+45210   B$=LEFT$(NF$,3)5220   PRINTB$;MID$(NF$,4,6);"        FREE GRANS: "; RIGHT$(NF$,3)5230   IF A$="H"LPRINTCHR$(31);"   ";B$;MID$(NF$,4,6);"     FREE GRANS: ";     RIGHT$(NF$,3):LPRINT STRING$(40,"-");CHR$(30)5240   QQ=0: Q=05250 NEXT X5260 PRINT: IF A$="H" THEN LPRINT" "5270 RETURN5280 '               *** PRINT BY FILENAME ***5290 IF A$="H" THEN GOSUB 40100: GOTO 53055300 W0=1: W=Z: GOTO 53605305 F1$=STRING$(18," "): F2$=STRING$(18," ")5310 W0=1: W=INT((Z+2)/3): P0=05320 IF W<=50 THEN 53605330 WS=W-50: W=50: W1=151: P0=1: GOTO 53605340 FOR II=1 TO 9: LPRINT" ": NEXT: W0=W1: IF WS<=57 THEN P0=0:      W=W1+WS: GOTO 53605350 W=W1+56: WS=WS-57: W1=W1+1715360 FOR X=W0 TO W5370   X1=X+W-W0+1: X2=X1+W-W0+15380   C(0)=X1: J=USR0(VARPTR(C(0))): LSET F1$=NF$5390   C(0)=X2: J=USR0(VARPTR(C(0))): LSET F2$=NF$5400   C(0)=X : J=USR0(VARPTR(C(0)))5410   IF A$<>"H" THEN PRINTX;") ";MID$(NF$,4,12);"  ";                RIGHT$(NF$,3);"  ";LEFT$(NF$,3): WS=WS+1:GOTO 54505420   LPRINT USING PF$+PF$;MID$(NF$,4,12); RIGHT$(NF$,3);LEFT$(NF$,3);MID$(F1$,4,12); RIGHT$(F1$,3);LEFT$(F1$,3);5430   IF X2>Z THEN LPRINT" ": GOTO 54605440   LPRINT USING PF$;MID$(F2$,4,12);RIGHT$(F2$,3);                  LEFT$(F2$,3)5450   Q$=INKEY$: IF Q$<>"" GOSUB 55105460 NEXT X5470 IF P0<>0 THEN 53405480 IF A$="H" THEN LPRINT" "5490 RETURN5500 '        ********** PAUSE OR ABORT **********5510 Q$=INKEY$5520 IF Q$="A"OR Q$="a" THEN 5105530 IF Q$="" THEN 55105540 RETURN6000 '        ************* FILE MANIPULATION **************6010 CLS: IFC(4)=0 THEN 50156015 CLS: PRINT@320,TAB(15)"**** FILE MANIPULATION ****":      PRINT: PRINT6020 PRINTTAB(15)"A - ADD RECORDS": PRINT6030 PRINTTAB(20)"S - SEARCH RECORDS":PRINT6035 PRINTTAB(25)"G - FREE GRANS SEARCH":PRINT6040 PRINT@768,"CHOICE ? ";: GOSUB 3106050 IF A$="A" THEN 60906060 IF A$="S" THEN 62506061 IFA$="G"THEN67006070 GOTO 5106080 REM            *** ADD RECORDS ***6090 IA=0: C(1)=1            'READY TO ADD TO ARRAY TOP6100 GOSUB 401506110 PRINT: PRINT"  TO ADD A FILE ENTER ONLY  XXX !!! (ELSE YYYYYXXX)"6120 A$="": PRINT@588,CHR$(31)"DISK NAME:    ";: INPUT A$6130 IF A$="" THEN IF IA=0 THEN 6010 ELSE GOSUB 4030: GOTO 60106140 IA=IA+16150 IF LEN(A$)=3 THEN 61906160 GT$="999": PRINT@652,"FREE GRANS:   ";: INPUT GT$6170 LSET NF$=RIGHT$(A$,3)+" "+LEFT$(A$,4)+RIGHT$("         "+GT$,10)6180 GOTO 62206190 PRINT@652,"FILENAME:     ";: INPUT B$6200 PRINT@716,"SIZE (GRANS): ";: INPUT C$6210 LSET NF$=A$+LEFT$(B$+"            ",12)+RIGHT$("   "+C$,3)6220 J=USR0(VARPTR(C(0)))6230 GOTO 61206240 REM             *** FIND/DELETE ***6250 IL=0: C(1)=0: C(0)=1            'READY TO READ ARRAY6260 GOSUB 401406270 PRINT@576,CHR$(31);"SEARCH BY (D)ISK OR (F)ILENAME  ? ";:      GOSUB 3106280 IF A$="D" THEN C(7)=0: GOTO 63206290 IF A$="F" THEN C(7)=3: GOTO 64716300 GOTO 60106310 REM             *** FIND/DELETE DISKS ***6320 IF FT$<>"DISK" THEN GOSUB 4030     'SORT BY DISK6330 B$="": PRINT@720,"DISK '#':  ";: INPUT B$6340 IF B$="" THEN 62506350 B$=RIGHT$("000"+B$,3)6360 C(8)=VARPTR(B$)6365 C(4)=C(4)+16370 J=USR2(VARPTR(C(0)))         'SEARCH FOR DISK6375 C(4)=C(4)-16380 IF J<>0 THEN 63906385 IF IL=0 THEN GOSUB 402506386 GOTO 62506390 IL=1: PRINT@770,NF$,"DISPLAY DIRECTORY  (Y/N)  ? ";: GOSUB 3106400 PRINT: IF A$<>"Y" THEN 62506401 CLS:PRINT"DISK DIRECTORY DISK NUMBER ";LEFT$(NF$,3);" NAMED "MID$(NF$,4,9)"   FREE GRANS:";RIGHT$(NF$,2)6410 CI=J: AI=C(9)     '1ST ELEMENT TO DELETE (# & ADDRESS)6420 JS=J+1: C(0)=JS              'LOOK AT NEXT ELEMENT6425 C(4)=C(4)+16430 J=USR2(VARPTR(C(0)))6435 C(4)=C(4)-16440 IF J<>0THENPRINTMID$(NF$,4,12),:GOTO64206441 PRINT:PRINT"DELETE THIS DISK (Y/N) ?";:GOSUB3106442 PRINT: IF A$<>"Y" THEN 62506450 CF=JS: AF=AI+(CF-CI)*C(6)    'FIRST NEW LIVE ELEMENT6460 GOSUB 6580: GOTO 62506470 REM             *** FIND/DELETE FILENAME ***6471 CLS:PRINT"FILENAME SEARCH":PRINT"You may perform a freeform search by entering a * in place"6472 PRINT"of the leading letters...e.g ****BAS/CMD will look for all":PRINT"files with any first four letters and the last 7 matching what":PRINT"you have entered.":PRINT:PRINT"You may also do an extension search by"6473 PRINT"entering /EXT where EXT is the extension you wish to examine.":PRINT"The slash (/) is necessary."6480 CMD"LC,N":B$="": PRINT@660,"FILENAME:  ";: INPUT B$6481 CMD"LC,Y"6490 IF B$="" THEN 62506491 IFLEFT$(B$,1)="/"THEN68506492 IFLEFT$(B$,1)<>"*"THEN65006493 FORQW=1TOLEN(B$)6494 IFMID$(B$,QW,1)<>"*"THEN64966495 NEXTQW6496 C(7)=QW+26497 B$=RIGHT$(B$,LEN(B$)-QW+1)6500 C(8)=VARPTR(B$)6505 C(4)=C(4)+16510 J=USR2(VARPTR(C(0)))         'SEARCH FOR FILENAME6515 C(4)=C(4)-16520 IF J<>0 THEN 65306525 IF IL=0 THEN GOSUB 402506526 PRINT@1000,"PRESS <ENTER)";: GOSUB 310:GOTO62506530 IL=1: PRINT"   ";LEFT$(NF$,3);"  ";RIGHT$(NF$,15),     "CONTINUE OR DELETE (C/D)  ? ";: GOSUB 310: PRINT6540 IF A$<>"D" THEN JS=J+1: GOTO 65616550 CI=J: AI=C(9): CF=J+1: AF=AI+C(6): JS=J6555 GOSUB 65806560 PRINT"QUIT? ";:GOSUB310:IFA$="Y"GOTO62506561 C(0)=JS6570 GOTO 6505      'KEEP LOOKING6580 PRINT@975,"<<< CLOSING UP THE ARRAY >>>";6585 CD=CF-CI: AD=(C(4)+1-CI)*C(6)6600 AF!=FNIS!(AF): AI!=FNIS!(AI): AD!=FNIS!(AD)6610 POKE HL+1,AF!/256: POKE HL, AF!-INT(AF!/256)*256:     POKE DE+1,AI!/256: POKE DE, AI!-INT(AI!/256)*256:     POKE BC+1,AD!/256: POKE BC, AD!-INT(AD!/256)*2566620 J=USR4(0)6630 C(4)=C(4)-CD: C(3)=C(3)-CD*C(6)       'ADJUST ARRAY TOP6640 PRINT@960,CHR$(30);: RETURN6700 ' free grans search6710 PRINT:PRINT"FREE GRANS SEARCH"6720 INPUT"How many grans to look for";GX6725 B$=""6730 FORX=1TOC(4)6740 C(0)=X:J=USR0(VARPTR(C(0)))6750 IFB$=LEFT$(NF$,3)THEN68006760 IFMID$(NF$,4,1)=" "THENIFVAL(RIGHT$(NF$,2))>=GXTHENPRINTNF$6780 Q$=INKEY$:IFQ$<>""THENGOSUB55106800 NEXTX6810 PRINT"Press <ENTER> to continue. ";:GOSUB310:GOTO62506850 FORX=1TOC(4)6860 C(0)=X:J=USR0(VARPTR(C(0)))6870 IFINSTR(NF$,"/")=0THEN69106880 TT$=MID$(NF$,INSTR(NF$,"/"),4)6890 IFTT$=B$THENPRINTMID$(NF$,4,12);"  DISK #:";LEFT$(NF$,3);" SIZE: ";RIGHT$(NF$,2);" GRAN(S)"6900 Q$=INKEY$:IFQ$<>""THENGOSUB55106910 NEXTX:GOTO681040000 REM                 ******* FORMATS *******40010 CLS: PRINT"DRIVE: ";DN;"     TITLE: ";DN$;"   --- CREATION DATE: ";DD$40020 PRINTTAB(9)" PROT  FILESPEC       SCTRS  GRANS"40030 PF$="          ##   %          %    ###    ###"40040 RETURN40050 PRINT: PRINT"DRIVE: ";DN;"    TITLE: ";DN$;"      FILES STORED: ";C(4): RETURN40060 PRINT@960,"PRESS <DRIVE #> TO READ ANOTHER DISK, <ANY KEY> FOR MENU ? ";40070 GOSUB 310: RETURN40080 PRINT@64,"NOTE : PRESS ANY KEY TO SUSPEND OUTPUT; PRESS AGAIN TO RESTART."40090 PRINT"       PRESS  'A'  THE SECOND TIME TO ABORT!!": RETURN40100 PF$="      %          % % % % %"40110 LPRINT" ":LPRINT" ":LPRINT" ": LPRINTSTRING$(79,"*"):LPRINTTAB(20)"STAN BARBER'S DISK FILES (BY ";FT$;")",DA$:LPRINTSTRING$(79,"*"):FORI=1TO4: LPRINT" ":NEXT:L=10:RETURN40115 FORII=1TO12:LPRINT" ":NEXT:L=6:RETURN40120 CLS:PRINT@128,"LOADING FROM DISK":PRINT:PRINT"CURRENT FILENAME IS "C$".":LINEINPUT"ENTER ANOTHER FILENAME IF YOU WISH TO CHANGE. ";B$:GOTO4013140130 CLS:PRINT@128,"DUMPING TO DISK":PRINT:PRINT"CURRENT FILE NAME IS "C$".":LINEINPUT"ENTER A NEW FILE NAME IF YOU WISH TO CHANGE. ";B$40131 IFB$<>""THENC$=B$40132 PRINT:PRINT:RETURN40140 CLS:PRINT@128,TAB(10)"**** SEARCH (AND EDIT) DISKS OR FILES ****":PRINT:GOTO 4016040150 CLS:PRINT@128,TAB(14)"**** ADD FILES TO THE ARRAY ****":PRINT40160 PRINTTAB(5)"CONVENTION - DISK NAME = YYYYYXXX":PRINTTAB(8)"XXX - DISK NUMBER (ALPHANUMERIC)":PRINTTAB(8)"YYYYY- DISK NAME":RETURN40170 CLS:PRINT@4,"LEM HILLS' DISK INDEX PROGRAM as modified by STAN BARBER":PRINTSTRING$(62,"%"):PRINT:RETURN40180 PRINT"  - PROGRAMMED TO HANDLE 1000 FILES (DISK NAME IS A FILE).        - MEMORY SIZE HAS BEEN SET TO B500H."40190 PRINT:PRINT"  - THE ARRAY IS MANAGED BY FAST MACHINE CODE."40200 PRINT:PRINT"  - YOU CAN SEE THE ARRAY AT ANY TIME BY HITTING BREAK              THEN GOSUB 45000 (HEX) OR GOSUB 46000 (ASCII).                  SEE LINES 120 AND 45000-46400 AND CHANGE AS YOU WISH.":RETURN40230 CLS: PRINT@458,"******  READY TO RESTART  ******":RETURN40240 CLS:PRINT@335,"**** DISK DIRECTORY READ ****":RETURN40250 PRINT: PRINTTAB(20)"N O T   F O U N D !!!!":      FORI=0TO500:NEXT: RETURN45000 '        ******* DEBUG AID (READS THE ARRAY) ********45010 H$="0123456789ABCDEF"45020 FOR I=0 TO IM45030   A=PEEK(U+I): B!=A/16: A=INT(B!): B=16*(B!-A)45040   A$=MID$(H$,A+1,1): B$=MID$(H$,B+1,1)45050   PRINTA$;B$;"  ";45060 NEXT I: RETURN46000 Q=046010 FOR I=0 TO IM46020   Q=Q+1: IF Q=19 THEN PRINT: Q=146030   PRINT CHR$(PEEK(U+I));"  ";46040 NEXT I: RETURN50530 REM           DISK CONTROL BLOCK (DCB)50540 U=&HFD80: M=9   '(20 BYTES)50550 DR=&HFD86:        'DRIVE50560 TR=&HFD8E:        'TRACK50570 TG=&HFD8F:        'GRANS/TRACK50580 SR=&HFD8A:        'REL TRACK SECTOR50590 ST=&HFD8C:        'SECTORS/TRACK50600 DB=&HFD80:        'DCB ADDRESS50610 BF=&HFF00:        'DISK READ BUFFER50620 GOSUB 50802: RETURN50630 DATA 24704, 0, 255, 256,0,0, 15, 0, -1, -1 :'SET FOR BOOT50640 '80 60 00 00 FF 00 00 01 00 00 00 00 10 00 00 01 FF FF FF50650 '         UREC     DN           NRN   ERN  DT DG50802 FOR I=0 TO M: READ A: A!=FNIS!(A)50804 A!=A!/256: B=INT(A!): A=INT((A!-B)*256)50806 POKE U+2*I,A: POKE U+2*I+1,B50808 NEXT: RETURN50810 REM                 CONTROL VECTOR50820 'ELEM KWKARRAY(KA)  SORT2(SO)  SEARCH2(SR)50830 C(0)=1:            'SPECIFIC ELEMENT # (KA), N/A (SO&SR)50840 C(1)=1:            'COMMAND (KA), N/A (SO&SR)                             0 - GET AN ELEMENT                             1 - PUT ELEMENT ON TOP                             2 - PUT ELEM TO SPECIFIC LOCATION50850 C(2)=&HB500:       'ARRAY START (ALL)50860 C(3)=&HB500:       'ARRAY END (KA&SR), N/A (SO)50870 C(4)=0:            '# OF ACTIVE ELEMENTS (ALL)50875 NF$=STRING$(18," ")50880 C(5)=VARPTR(NF$):  'PASSING STRING (KA&SR), N/A (SO)50890 C(6)=18	:           'ELEM LENGTH (SO&SR), N/A (KA)50900 C(7)=0:            'KEY OFFSET (SO&SR), N/A (KA)50910 C(8)=18:           'LEN SORT FIELD (SO), N/A (KA)                             VARPTR(SEARCH KEY) (SR)50920 C(9)=&H3C00:       'WORK AREA (LEN=C%(8)) (SO), N/A (KA)                            RETURN ADDRESS OF ELEM FOUND (SR)50930 DEFUSR0=&HFB50: DEFUSR1=&HFBE0: DEFUSR2=&HFCD0:       DEFUSR3=&HFDA0: DEFUSR4=&HFDC0: DEFUSR5=&HFE0050940 HL=&HFDC1: DE=&HFDC4: BC=&HFDC7: DR=&HFD86: TR=&HFD8E:       TG=&HFD8F: SR=&HFD8A: ST=&HFD8C: DB=&HFD80: BF=&HFF0050950 RETURN                    