*
* "cxd33.o"
* _cxd33 is a 32 bit signed divide
* _cxd22 is a 32 bit unsigned divide
* standard Lattice routine except I added a check for divide by zero
* d0(32) / d1(32) = d0(32)


         XDEF _CXD22
         XDEF _CXD33

         csect    text

_CXD33   TST.L     D0
         BPL       j22
         NEG.L     D0
         TST.L     D1
         BPL       j18
         NEG.L     D1
         BSR       _CXD22
         NEG.L     D1
         RTS
j18      BSR       _CXD22
         NEG.L     D0
         NEG.L     D1
         RTS
j22      TST.L     D1
         BPL       _CXD22
         NEG.L     D1
         BSR       _CXD22
         NEG.L     D0
         RTS

_CXD22   TST.L     D1
         BNE       ok
         CLR.L     D0
         RTS

ok       MOVE.L    D2,-(A7)
         SWAP      D1
         MOVE.W    D1,D2
         BNE       j5C
         SWAP      D0
         SWAP      D1
         SWAP      D2
         MOVE.W    D0,D2
         BEQ       j4C
         DIVU      D1,D2
         MOVE.W    D2,D0
j4C      SWAP      D0
         MOVE.W    D0,D2
         DIVU      D1,D2
         MOVE.W    D2,D0
         SWAP      D2
         MOVE.W    D2,D1
         MOVE.L    (A7)+,D2
         RTS
j5C      MOVE.L    D3,-(A7)
         MOVEQ     #10,D3
         CMPI.W    #0080,D1
         BCC       j6C
         ROL.L     #8,D1
         SUBQ.W    #8,D3
j6C      CMPI.W    #0800,D1
         BCC       j78
         ROL.L     #4,D1
         SUBQ.W    #4,D3
j78      CMPI.W    #2000,D1
         BCC       j84
         ROL.L     #2,D1
         SUBQ.W    #2,D3
j84      TST.W     D1
         BMI       j8E
         ROL.L     #1,D1
         SUBQ.W    #1,D3
j8E      MOVE.W    D0,D2
         LSR.L     D3,D0
         SWAP      D2
         CLR.W     D2
         LSR.L     D3,D2
         SWAP      D3
         DIVU      D1,D0
         MOVE.W    D0,D3
         MOVE.W    D2,D0
         MOVE.W    D3,D2
         SWAP      D1
         MULU      D1,D2
         SUB.L     D2,D0
         BCC       jB2
         SUBQ.W    #1,D3
         ADD.L     D1,D0
wierd    BCC       wierd
jB2      MOVEQ     #00,D1
         MOVE.W    D3,D1
         SWAP      D3
         ROL.L     D3,D0
         SWAP      D0
         EXG       D0,D1
         MOVE.L    (A7)+,D3
         MOVE.L    (A7)+,D2
         RTS
         END

